const BusMsg = require("./BusMsg");

class BusMsgSub extends BusMsg
{
    callback;
    content;
    QoS;
    isAutoGenerated;

    constructor(_topic, _callback, _class, _QoS, _auto){
        super(_topic, _class);
        this.callback = _callback;
        this.QoS = _QoS;
        if(_auto != null){
            this.isAutoGenerated = _auto;
        } else {
            this.isAutoGenerated = false;
        }
    };

    decode(_payload){
        //console.log(`decode...(${this.type})`);
        if(this.type === 0){ // it is a unknown class
            this.content = 'unknown';
        } else if(this.type === 1){ // it is a protobuf class
           // decode the payload
           this.content = this.class.decode(_payload); 
        } else if(this.type === 2){ // it is a javascript object
           this.content = JSON.parse(_payload);
        } else if(this.type === 3){
           this.content = _payload.toString();
        }
        return this.content;
    };

    /**
     * clones this instance with a new topic and isAutoGenerated set to true.
     * @param {*} _topic
     */
    clone(_topic){
        return new BusMsgSub(_topic, this.callback, this.class, this.QoS, true);
    }
}

module.exports = BusMsgSub;
